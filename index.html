<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gorem Awards 2025</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --card-bg: rgba(30, 30, 30, 0.6);
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent: #FFD700;
            --accent-dim: rgba(255, 215, 0, 0.2);
            --error: #ff4d4d;
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #2a2a2a 0%, #0f0f0f 70%);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px 20px 100px 20px; /* –ë–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
            -webkit-tap-highlight-color: transparent;
        }

        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: 800;
            margin: 10px 0 5px 0;
            background: linear-gradient(135deg, #fff 30%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 30px;
        }

        /* --- CATEGORIES --- */
        .category-section {
            margin-bottom: 40px;
            scroll-margin-top: 20px; /* –î–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        }

        .category-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--accent);
            text-transform: uppercase;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            display: inline-block;
        }

        .category-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-style: italic;
        }

        .grid {
            display: grid;
            gap: 12px;
        }
        .grid-people { grid-template-columns: repeat(2, 1fr); }
        .grid-wide { grid-template-columns: 1fr; }

        /* --- CARDS --- */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 12px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            overflow: hidden;
        }

        .card:active { transform: scale(0.98); }

        .card.selected {
            border-color: var(--accent);
            background: var(--accent-dim);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }
        
        .you-badge {
            position: absolute; top: 5px; right: 5px;
            background: var(--error); color: white;
            font-size: 10px; padding: 2px 6px;
            border-radius: 4px; font-weight: bold; z-index: 10;
        }

        .card-img { width: 100%; height: auto; border-radius: 12px; margin-bottom: 8px; object-fit: cover; }
        .people-img { aspect-ratio: 1/1; border-radius: 50%; width: 80px; height: 80px; margin: 0 auto 10px auto; border: 2px solid rgba(255,255,255,0.1); object-fit: cover; }
        .card.selected .people-img { border-color: var(--accent); }

        .card-title { font-size: 14px; font-weight: 600; line-height: 1.2; margin-bottom: 2px; }
        .card-subtitle { font-size: 11px; color: var(--text-secondary); }

        .card-suggest {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border: 1px dashed var(--text-secondary); min-height: 130px;
        }
        .card-suggest i { font-size: 24px; margin-bottom: 5px; color: var(--text-secondary); }

        /* --- SEARCH MODAL --- */
        #searchModal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #000; z-index: 1000; padding: 20px; flex-direction: column;
        }
        #searchInput {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: #222; color: white; font-size: 16px; margin-bottom: 20px; outline: none; box-sizing: border-box;
        }
        #searchInput:focus { box-shadow: 0 0 0 2px var(--accent); }
        #searchResults { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .search-item { padding: 15px; background: #1a1a1a; border-radius: 10px; cursor: pointer; display: flex; justify-content: space-between; }
        .search-item:active { background: #333; }
        .search-item .nick { color: var(--accent); font-size: 12px; }
        .close-modal { position: absolute; top: 15px; right: 15px; color: #fff; font-size: 24px; cursor: pointer; }

        /* --- BOTTOM BUTTON --- */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            padding: 15px 20px 25px 20px;
            background: linear-gradient(0deg, rgba(15,15,15,1) 0%, rgba(15,15,15,0.9) 70%, rgba(15,15,15,0) 100%);
            z-index: 100;
            display: flex; justify-content: center;
        }

        .submit-btn {
            width: 100%;
            max-width: 400px;
            background-color: var(--accent);
            color: #000;
            font-size: 16px;
            font-weight: 700;
            padding: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            transition: transform 0.1s;
        }
        
        .submit-btn:active { transform: scale(0.98); }
        .submit-btn:disabled { background-color: #333; color: #777; box-shadow: none; }

    </style>
</head>
<body>

    <h1>üèÜ Gorem Awards 2025</h1>
    <p class="subtitle">–ß–∞—Ç —Ä–∞–±–æ–≤</p>

    <div id="app"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ -->
    <div id="searchModal">
        <div class="close-modal" onclick="closeSearch()">‚úï</div>
        <h2 style="margin-top: 40px; text-align: center;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h2>
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –Ω–∏–∫—É..." oninput="filterSearch()">
        <div id="searchResults"></div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (—Ç–µ–ø–µ—Ä—å –∫–∞—Å—Ç–æ–º–Ω–∞—è) -->
    <div class="bottom-bar">
        <button id="sendButton" class="submit-btn" onclick="sendVotes()">
            –û–¢–ü–†–ê–í–ò–¢–¨ –ì–û–õ–û–°–ê (0/6)
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å–æ–æ–±—â–∞–µ–º –¢–ì, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
        tg.ready();

        const currentUser = tg.initDataUnsafe?.user || { username: 'test_user', id: 123 }; 
        const currentUsername = currentUser.username ? currentUser.username.toLowerCase() : '';

        // --- –î–ê–ù–ù–´–ï (–¢–æ—Ç –∂–µ —Å–ø–∏—Å–æ–∫) ---
        const communityListRaw = `
–Ω–µ–π—Ä–æ–Ω–∫–∞ (@legolasuz)
–±–µ–ª—è—à (@BelyashikKEK)
Hqunik‚ù§Ô∏è (@Hqunik)
PIZZAYOLO (@ERROR_SANS_KILLINK)
halopiküçå (@Devaninno)
–ì–µ–∫—Ç–æ—Ä –í–µ–∫—Ç–æ—Ä (@stasikolp5)
Tymofii Ushakov (@tim_udim)
–î–ñ–û–ù–ù–ò (@MASTURBIST250000TONTROTILA)
Fin3_j (@Fin3_j)
BUTYLKA (@No0o0l)
Flowey (@SyFleChKA)
–ù–∏–∫ –£–∫—Ä–∞–ª–∏ –¶—ã–≥–∞–Ω–µ (@Potetochnik)
ìÜ©‚≤Å‚≤õ‚≥ã‚≤â‚≥ë‚≤ì‚≤õ‚≤ïìÜ™ (@SirenaGargonovna)
–ê–ª–µ–∫—Å–µ–π –õ–∞–ø–∞–µ–≤ (@ManipuliatorKukoldovich)
–í–∞—Ñ–ª—è (@Wonderwaffle_1)
enddarkness (@enddarknesstf)
Rashka (@rashka144)
Knight (@Tokitoyy)
–†–æ–º–∞—à–µ—á–∫–∞ (@chamomilekwysee)
Beeq (@BeeQ228)
–í–∞—Ä—â–∏–∫ (@Krockodildo)
–∫–∞–º–µ–Ω—å (@kamen22832)
Nh (@armirr)
–í–∏—à–Ω—è (@MRVishnia)
Va+LeraHachapurya (@Eeeeeeerrrrrrrrrrrrooooooorrrrrr)
–ö–æ—Ç–∞—Ä (@RussianCAT905)
Static Miku (@Stat1cMiku)
–û–±—Ä—ã–≥–∞–Ω—á–∏–∫ (@its_obrigan)
–ö–∏–º–ø–∏–Ω—Ç—è—É (@JOTAN82)
Jack700 (@c700sJ)
Gigo (@Brat_417)
Gerome (@CHICKEN1W)
Mio (@St1go2)
–û—á –¥–ª–∏–Ω–Ω—ã–π –Ω–∏–∫ (@Prostodadva)
4ebyre4ekman (@Mr_4ebyre4ekman)
–†–∞–Ω–¥–æ–º
–§–°–ë (@U19221991)
T.·ëéb‚Å¨ (@T1NDEX)
–°–ê–ù–Ø 4–ö (@Myyydachoch)
Caerzav (@Caerzav)
‚≤Ñ‚≤ü‚≤©‚≤•‚≤ßœÖ‚≤ï ‚≤ò‚≤ü‚≤£‚≤ü‚≥Ö ‚≤¨‚≤û‚≤¨‚≤û‚≤¨‚≤û‚õÑÔ∏è (@Miliy_Ghost)
–ö–µ–Ω—Å–∏—Ä–æ (@Kenshiro_12)
–ù (@Pepega_14)
ùóïùó≤ùóÆùó∞ùóµùó≤ùòÄùóöùóºùòÅùó® (@akramilerk)
–ú–∏—Ö–∞–∏–ª (@NE_pubertat)
AlekseyFeed (@AlekseyFeed)
DIMA (@DMSSOUL)
Badger (@Gummanitariy)
SOCHNIJ (@UZENESOCHNIJ)
–ú—è—É–∫ (@mimimimiiiiimi)
Cheems (@CheemsWasTaken)
‚Ä¢¬∞ùöÜùöäùöçùöé_ùöÜùöíùöïùöïùöúùöòùöó¬∞‚Ä¢ (@MyLittleAmnesia)
–°–µ—Ä—ë–≥–∞ –∏–ª–∏ –°–µ—Ä—ë–∂–∞ –∏–ª–∏ –°–µ—Ä–≥–µ–π (@SeryoGaa)
–ú–∞—Ç–≤–µ–π –ì–æ–ª–æ–±–æ–∫–æ–≤ (@kubik_rubik2005)
Zthyzs (@Crydot)
Ugmivve (@Ugm1vve)
Max Maxbetov (@Tulac_Chord)
`;

        const communityList = communityListRaw.trim().split('\n').map(line => {
            const match = line.match(/(.*)\s\(@(.*)\)/);
            if (match) {
                return { name: match[1].trim(), username: match[2].trim() };
            }
            return { name: line.trim(), username: '' };
        });

        const categories = [
            {
                id: 'moderator', title: 'üõ° –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –≥–æ–¥–∞', desc: '–ö—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–º–æ–≥–∞–ª –ê–Ω–≥–µ–ª–∏–Ω–µ –∏ –Ω–µ –±–µ—Å–∏–ª –µ—ë', allowSuggest: true, type: 'people',
                candidates: [
                    { name: 'ìÜ©‚≤Å‚≤õ‚≥ã‚≤â‚≥ë‚≤ì‚≤õ‚≤ïìÜ™', username: 'SirenaGargonovna', img: 'https://i.postimg.cc/cL3jWfFK/IMG_20251211_005940_935.jpg' },
                    { name: '–ê–ª–µ–∫—Å–µ–π –õ–∞–ø–∞–µ–≤', username: 'ManipuliatorKukoldovich', img: 'https://i.postimg.cc/3xG6h2tk/IMG_20251211_005947_715.jpg' },
                    { name: '–ú—è—É–∫', username: 'mimimimiiiiimi', img: 'https://i.postimg.cc/x1m7QL68/IMG_20251211_005959_341.jpg' },
                    { name: '‚≤Ñ‚≤ü‚≤©‚≤•‚≤ßœÖ‚≤ï ‚≤ò‚≤ü‚≤£‚≤ü‚≥Ö', username: 'Miliy_Ghost', img: 'https://i.postimg.cc/52zGJ8s6/IMG_20251211_010021_633.jpg' },
                    { name: 'T.·ëéb‚Å¨', username: 'T1NDEX', img: 'https://i.postimg.cc/L8P7Sjxs/IMG_20251211_010025_534.jpg' },
                    { name: '–ö–æ—Ç–∞—Ä', username: 'RussianCAT905', img: 'https://i.postimg.cc/0yS3v7VQ/IMG_20251211_010041_079.jpg' }
                ]
            },
            {
                id: 'active', title: '‚ö° –ê–∫—Ç–∏–≤ –≥–æ–¥–∞', desc: '–ö–æ–≥–æ –≤—ã –≤–∏–¥–µ–ª–∏ –≤ —á–∞—Ç–µ —á–∞—â–µ –≤—Å–µ–≥–æ', allowSuggest: true, type: 'people',
                candidates: [
                    { name: 'Tymofii Ushakov‚ô•Ô∏è', username: 'tim_udim', img: 'https://i.postimg.cc/3x6vXvhj/IMG_20251211_011101_145.jpg' },
                    { name: 'T.·ëéb‚Å¨', username: 'T1NDEX', img: 'https://i.postimg.cc/L8P7Sjxs/IMG_20251211_010025_534.jpg' },
                    { name: '–∫–∞–º–µ–Ω—å', username: 'kamen22832', img: 'https://i.postimg.cc/sgW8z5T3/IMG_20251211_010107_354.jpg' },
                    { name: '‚≤Ñ‚≤ü‚≤©‚≤•‚≤ßœÖ‚≤ï ‚≤ò‚≤ü‚≤£‚≤ü‚≥Ö', username: 'Miliy_Ghost', img: 'https://i.postimg.cc/52zGJ8s6/IMG_20251211_010021_633.jpg' },
                    { name: '–ú–∏—Ö–∞–∏–ª', username: 'NE_pubertat', img: 'https://i.postimg.cc/dVCXFG5w/IMG_20251211_010131_324.jpg' },
                    { name: '–ù–µ–π—Ä–æ–Ω–∫–∞', username: 'legolasuz', img: 'https://i.postimg.cc/BnFy32ms/IMG_20251211_010141_108.jpg' }
                ]
            },
            {
                id: 'crypto', title: 'üíé –ö—Ä–∏–ø—Ç–∞–Ω –≥–æ–¥–∞', desc: '–°–∞–º—ã–π –±–æ–≥–∞—Ç—ã–π —Ñ–∞—Ä–º–∏–ª–∞', allowSuggest: true, type: 'people',
                candidates: [
                    { name: '–ù–∏–∫ –£–∫—Ä–∞–ª–∏ –¶—ã–≥–∞–Ω–µ', username: 'Potetochnik', img: 'https://i.postimg.cc/fRF9c9sB/IMG_20251211_011054_829.jpg' },
                    { name: '–ê–ª–µ–∫—Å–µ–π –õ–∞–ø–∞–µ–≤', username: 'ManipuliatorKukoldovich', img: 'https://i.postimg.cc/3xG6h2tk/IMG_20251211_005947_715.jpg' },
                    { name: '–í–∞—Ñ–ª—è', username: 'Wonderwaffle_1', img: 'https://i.postimg.cc/wjNPzDw6/IMG_20251211_010157_401.jpg' },
                    { name: 'Tymofii Ushakov‚ô•Ô∏è', username: 'tim_udim', img: 'https://i.postimg.cc/3x6vXvhj/IMG_20251211_011101_145.jpg' },
                    { name: 'Va+LeraHachapurya', username: 'Eeeeeeerrrrrrrrrrrrooooooorrrrrr', img: 'https://i.postimg.cc/3xG6h2t5/IMG_20251211_010203_282.jpg' },
                    { name: '–∫–∞–º–µ–Ω—å', username: 'kamen22832', img: 'https://i.postimg.cc/sgW8z5T3/IMG_20251211_010107_354.jpg' }
                ]
            },
            {
                id: 'project', title: 'üöÄ –ü—Ä–æ–µ–∫—Ç –≥–æ–¥–∞', desc: '–ü—Ä–æ–µ–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –≤–∞–º –±–æ–ª—å—à–µ –≤—Å–µ—Ö', allowSuggest: false, type: 'content',
                candidates: [
                    { name: '–°–µ—Ä–∏—è –Ω–µ–¥–æ-–∫–æ–º–∏–∫—Å–æ–≤', img: 'https://i.postimg.cc/1tF2mwmH/IMG-20251211-012256-680.jpg' },
                    { name: '–ì–æ—Ä–µ–º –±–æ—Ç', img: 'https://i.postimg.cc/vmTds4xq/1000002494.jpg' },
                    { name: '–¢–∏–º–æ—Ñ–µ–π-—Ç—è–Ω', img: 'https://i.postimg.cc/3wNHTk0b/images_(5).jpg' },
                    { name: '–ù–æ—è–±—Ä—å—Å–∫–∞—è –∞–≤–∞ –ê–Ω–≥–µ–ª–∏–Ω—ã', img: 'https://i.postimg.cc/TYnd75nC/IMG_20251211_011906_588.jpg' },
                    { name: '–ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –º–∏—Ä –ê–ª–µ–∫—Å–µ—è', img: 'https://i.postimg.cc/zfJ9kVkJ/IMG-20251211-011816-827.jpg' },
                    { name: '–î–∏—Å–∫–æ—Ä–¥ –≥–æ—Ä–µ–º–∞', img: 'https://www.goha.ru/s/A:BQ/IN/mRePNTkx5p.png' }
                ]
            },
            {
                id: 'ava', title: 'üñº –ê–≤–∞ –≥–æ–¥–∞', desc: '–°–∞–º–∞—è –∫—Ä—É—Ç–∞—è –∞–≤–∞ –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é', allowSuggest: false, type: 'content',
                candidates: [
                    { name: '–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∞–≤–∞', img: 'https://i.postimg.cc/J7f755H0/IMG_20251211_011903_800.jpg' },
                    { name: '–ù–æ—è–±—Ä—å—Å–∫–∞—è –∞–≤–∞', img: 'https://i.postimg.cc/TYnd75nC/IMG_20251211_011906_588.jpg' },
                    { name: '–û–±—ã—á–Ω–∞—è –∞–≤–∞', img: 'https://i.postimg.cc/XNRNkkBv/IMG_20251211_011907_869.jpg' },
                    { name: '–õ—É–Ω–Ω–∞—è –∞–≤–∞', img: 'https://i.postimg.cc/c1p1BBtH/IMG_20251211_011909_763.jpg' },
                    { name: '–ü–µ—Ä–≤–∞—è –∞–≤–∞', img: 'https://i.postimg.cc/CM3MssnM/IMG_20251211_011912_016.jpg' }
                ]
            },
            {
                id: 'phrase', title: 'üí¨ –§—Ä–∞–∑–∞ –≥–æ–¥–∞', desc: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã', allowSuggest: false, type: 'content-wide',
                candidates: [
                    'https://i.postimg.cc/gcR6vJtX/IMG-20251211-005354-358.png',
                    'https://i.postimg.cc/mgdcbFhB/IMG-20251211-004923-610.png',
                    'https://i.postimg.cc/4x8KJhnX/IMG-20251211-004929-237.png',
                    'https://i.postimg.cc/JzTy1BtC/IMG-20251211-004938-950.png',
                    'https://i.postimg.cc/vZP1Q6DM/IMG-20251211-004955-460.png',
                    'https://i.postimg.cc/0yt68JrR/IMG-20251211-005018-949.png',
                    'https://i.postimg.cc/L8yqHZhM/IMG-20251211-005049-212.png',
                    'https://i.postimg.cc/CxvZFfdy/IMG-20251211-005054-836.png',
                    'https://i.postimg.cc/CxvZFf5W/IMG-20251211-005100-446.png',
                    'https://i.postimg.cc/6pH79Gq1/IMG-20251211-005105-757.png',
                    'https://i.postimg.cc/g2MwY6j7/IMG-20251211-005125-680.png',
                    'https://i.postimg.cc/K89KZgjH/IMG-20251211-005155-958.png',
                    'https://i.postimg.cc/SxZXyzRD/IMG-20251211-005306-688.png',
                    'https://i.postimg.cc/Z5f9Tynj/IMG-20251211-005311-635.png',
                    'https://i.postimg.cc/Bnh8q1bm/IMG-20251211-005316-965.png',
                    'https://i.postimg.cc/SxZXyzRZ/IMG-20251211-005334-899.png'
                ]
            }
        ];

        let votes = {};
        let activeCategoryForSearch = null;

        const app = document.getElementById('app');
        const sendBtn = document.getElementById('sendButton');

        function render() {
            categories.forEach(cat => {
                const section = document.createElement('div');
                section.className = 'category-section';
                section.id = 'sec-' + cat.id; // –î–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏

                const title = document.createElement('div');
                title.className = 'category-title';
                title.innerText = cat.title;

                const desc = document.createElement('div');
                desc.className = 'category-desc';
                desc.innerText = cat.desc;

                const grid = document.createElement('div');
                grid.className = 'grid';
                if (cat.type === 'people') grid.classList.add('grid-people');
                if (cat.type === 'content-wide') grid.classList.add('grid-wide');
                else if (cat.type === 'content') grid.classList.add('grid-people');

                cat.candidates.forEach((cand, index) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    let candId, candName, candImg;
                    if (cat.type === 'content-wide') {
                        candId = index;
                        candName = `–§—Ä–∞–∑–∞ #${index + 1}`;
                        candImg = cand;
                    } else {
                        candId = cand.username || cand.name;
                        candName = cand.name;
                        candImg = cand.img;
                    }

                    const isSelf = (cat.type === 'people' && cand.username && cand.username.toLowerCase() === currentUsername);

                    if (isSelf) {
                        card.classList.add('disabled');
                        card.innerHTML += `<div class="you-badge">–≠–¢–û –¢–´</div>`;
                    }

                    if (cat.type === 'people') {
                        card.innerHTML += `<img src="${candImg}" class="people-img" alt="img">`;
                    } else {
                        card.innerHTML += `<img src="${candImg}" class="card-img" alt="img">`;
                    }

                    card.innerHTML += `<div class="card-title">${candName}</div>`;
                    if (cand.username) card.innerHTML += `<div class="card-subtitle">@${cand.username}</div>`;

                    if (!isSelf) {
                        card.addEventListener('click', () => vote(cat.id, candId, card, section));
                    }
                    grid.appendChild(card);
                });

                if (cat.allowSuggest) {
                    const suggestCard = document.createElement('div');
                    suggestCard.className = 'card card-suggest';
                    suggestCard.id = `suggest-${cat.id}`;
                    suggestCard.innerHTML = `<i>+</i><div>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å</div>`;
                    suggestCard.addEventListener('click', () => openSearch(cat.id));
                    grid.appendChild(suggestCard);
                }

                section.appendChild(title);
                section.appendChild(desc);
                section.appendChild(grid);
                app.appendChild(section);
            });
        }

        function vote(catId, value, cardEl, sectionEl) {
            const allCards = sectionEl.querySelectorAll('.card');
            allCards.forEach(c => c.classList.remove('selected'));
            cardEl.classList.add('selected');
            votes[catId] = value;
            updateButton();
        }

        function updateButton() {
            const count = Object.keys(votes).length;
            const total = categories.length;
            sendBtn.innerText = `–û–¢–ü–†–ê–í–ò–¢–¨ –ì–û–õ–û–°–ê (${count}/${total})`;
            
            if (count === total) {
                sendBtn.style.opacity = "1";
            } else {
                sendBtn.style.opacity = "0.8";
            }
        }

        function sendVotes() {
            const count = Object.keys(votes).length;
            const total = categories.length;

            if (count < total) {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –Ω–µ –≤—Å–µ
                tg.showAlert(`–í—ã –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ —Ç–æ–ª—å–∫–æ –≤ ${count} –∏–∑ ${total} –Ω–æ–º–∏–Ω–∞—Ü–∏–π!\n–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤–µ–∑–¥–µ.`);
                
                // –ù–∞–π—Ç–∏ –ø–µ—Ä–≤—É—é –ø—Ä–æ–ø—É—â–µ–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–µ–π
                const missing = categories.find(c => !votes[c.id]);
                if (missing) {
                    document.getElementById('sec-' + missing.id).scrollIntoView({behavior: 'smooth'});
                }
                return;
            }

            // –û—Ç–ø—Ä–∞–≤–∫–∞
            try {
                tg.sendData(JSON.stringify(votes));
                // –ï—Å–ª–∏ –Ω–µ –∑–∞–∫—Ä—ã–ª–æ—Å—å —Å–∞–º–æ (–±—ã–≤–∞–µ—Ç –≥–ª—é–∫), –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => { tg.close(); }, 300);
            } catch (e) {
                tg.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.");
            }
        }

        function openSearch(catId) {
            activeCategoryForSearch = catId;
            document.getElementById('searchModal').style.display = 'flex';
            document.getElementById('searchInput').focus();
            filterSearch();
        }

        function closeSearch() {
            document.getElementById('searchModal').style.display = 'none';
        }

        function filterSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '';

            const filtered = communityList.filter(u => 
                u.name.toLowerCase().includes(query) || 
                u.username.toLowerCase().includes(query)
            );

            filtered.forEach(u => {
                if (u.username.toLowerCase() === currentUsername) return;

                const item = document.createElement('div');
                item.className = 'search-item';
                item.innerHTML = `<span>${u.name}</span> <span class="nick">${u.username ? '@'+u.username : ''}</span>`;
                item.addEventListener('click', () => selectCustomCandidate(u));
                resultsDiv.appendChild(item);
            });
        }

        function selectCustomCandidate(user) {
            closeSearch();
            const suggestCard = document.getElementById(`suggest-${activeCategoryForSearch}`);
            const section = suggestCard.parentElement.parentElement;
            
            suggestCard.innerHTML = `
                <div class="people-img" style="background:#333; display:flex; align-items:center; justify-content:center; font-size:20px;">üë§</div>
                <div class="card-title">${user.name}</div>
                <div class="card-subtitle">${user.username ? '@'+user.username : ''}</div>
            `;
            
            vote(activeCategoryForSearch, `SUGGESTED:${user.name}|${user.username}`, suggestCard, section);
        }

        render();
        updateButton();

    </script>
</body>
</html>
